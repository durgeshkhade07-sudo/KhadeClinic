<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khade Clinic | Book Appointment</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <div class="container d-flex flex-column justify-content-center align-items-center vh-100">
        <div class="card main-card animate__animated animate__zoomIn">
            
            <div class="text-center mb-3">
                <svg width="70" height="70" viewBox="0 0 24 24" fill="none" stroke="#004A99" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="animate__animated animate__pulse animate__infinite">
                    <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                </svg>
            </div>

            <h2 class="text-center medical-title">Khade Clinic</h2>
            <p class="text-center text-muted small mb-4">Available 24/7 ‚Ä¢ Professional Healthcare</p>
            
            <div id="form-container">
                <div class="mb-3">
                    <input type="text" id="name" class="form-control custom-input" placeholder="Patient Full Name" required>
                </div>

                <div class="row mb-3">
                    <div class="col-6">
                        <input type="number" id="age" class="form-control custom-input" placeholder="Age" required>
                    </div>
                    <div class="col-6">
                        <select id="gender" class="form-select custom-input">
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="mb-3">
                    <input type="text" id="mobile" class="form-control custom-input" placeholder="Mobile Number" required>
                </div>

                <div class="mb-4">
                    <select id="dept" class="form-select custom-input">
                        <option value="General Physician">General Physician</option>
                        <option value="Paediatric">Paediatric (Child Care)</option>
                        <option value="Orthopedic">Orthopedic Specialist</option>
                    </select>
                </div>

                <button onclick="submitBooking()" class="btn btn-medical w-100 py-3">Generate Token</button>
            </div>

            <div id="success-container" class="d-none animate__animated animate__fadeInUp">
                <div class="result-box text-center">
                    <p class="mb-1">Welcome, <span id="display-name" class="fw-bold text-primary"></span></p>
                    <small id="display-info" class="text-muted d-block mb-2"></small>
                    <div class="token-circle mx-auto mb-3">
                        <h1 id="display-token" class="mb-0">0</h1>
                    </div>
                    <p class="small text-success fw-bold">Token Generated Successfully!</p>
                    <hr>
                    <a id="pdf-btn" href="#" target="_blank" class="btn btn-outline-primary w-100">üìÑ Download Report (PDF)</a>
                    <button onclick="location.reload()" class="btn btn-link btn-sm mt-2 text-decoration-none">Book Another Appointment</button>
                </div>
            </div>
        </div>

        <div class="mt-4 text-center text-muted animate__animated animate__fadeInUp footer-info">
            <p class="mb-0 fw-bold">üìç Main Road, Bank of India Bhiwapur 441201</p>
            <p class="mb-0">üìû Helpline: 7709851625 | üïí 24/7 Available</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        async function submitBooking() {
            const data = {
                name: document.getElementById('name').value,
                age: document.getElementById('age').value,
                gender: document.getElementById('gender').value,
                mobile: document.getElementById('mobile').value,
                department: document.getElementById('dept').value
            };

            // Basic Validation
            if(!data.name || !data.age || !data.mobile) {
                alert("Please fill in all the details correctly.");
                return;
            }

            try {
                const res = await axios.post('/book', data);
                
                // Hide Form, Show Success
                document.getElementById('form-container').classList.add('d-none');
                document.getElementById('success-container').classList.remove('d-none');
                
                // Update UI with Response Data
                document.getElementById('display-name').innerText = res.data.patient;
                document.getElementById('display-info').innerText = `${data.age} Yrs | ${data.gender} | ${res.data.dept}`;
                document.getElementById('display-token').innerText = res.data.token;
                document.getElementById('pdf-btn').href = `/generate_pdf/${res.data.token}`;

            } catch (err) {
                console.error(err);
                alert("Server Connection Error! Please make sure your Python app is running.");
            }
        }
    </script>
</body>
</html>